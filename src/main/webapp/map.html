
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>내 주변 고수찾기</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<div id="map" style="width:100%;height:500px;"></div>
<button id="mapbtn">고수찾기</button>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=53f9ac8e1b09677c674e020964ff22be&libraries=services"></script>
<script type="text/javascript">


var listData = [];



 $.ajax(								 
		{
			url:"GosuMap_Ajax", 
			dataType:"JSON",
			
			success:function(responsedata){
				
				console.log(responsedata);

				var coordobj = {};
				var infowindow1 = null;
				var mapContainer = document.getElementById('map'), // 지도를 표시할 div  
				    mapOption = { 
				        center: new kakao.maps.LatLng(37.56646 , 126.9821), // 지도의 중심좌표
				        level: 4 // 지도의 확대 레벨
				    };

				var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

				navigator.geolocation.getCurrentPosition(function(pos) {
				    var latitude = pos.coords.latitude;
				    var longitude = pos.coords.longitude;

				    
				    //localStorage.setItem("사용자의 위치" , JSON.stringify(coordobj));
				    var currentPos = new kakao.maps.LatLng(latitude,longitude);

				 	// 지도 이동(기존 위치와 가깝다면 부드럽게 이동)
				    map.panTo(currentPos);

				    // 마커 생성
				    var marker = new kakao.maps.Marker({
				        position: currentPos
				    });

				    
				    // 기존에 마커가 있다면 제거
				    marker.setMap(null);
				    marker.setMap(map);
				    
				 	// 인포윈도우를 생성합니다 
					infowindow1 = new kakao.maps.InfoWindow({ 
						content: '<div style="width:150px; text-align:center; padding:6px 0;">' +"현위치" + '</div>', 
						//removable : true 
					}); 
				 	
					 // 마커에 mouseover 이벤트와 mouseout 이벤트를 등록합니다
				    // 이벤트 리스너로는 클로저를 만들어 등록합니다 
				    // for문에서 클로저를 만들어 주지 않으면 마지막 마커에만 이벤트가 등록됩니다
				    kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow1));
				    kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow1));
				 	
					//infowindow1.open(map, marker); 

				});

				function locationLoadError(pos){
				    alert('위치 정보를 가져오는데 실패했습니다.');
				};

				//인포윈도우를 표시하는 클로저를 만드는 함수입니다 
				function makeOverListener(map, marker, infowindow) {
				    return function() {
				        infowindow1.open(map, marker);
				    };
				}

				// 인포윈도우를 닫는 클로저를 만드는 함수입니다 
				function makeOutListener(infowindow) {
				    return function() {
				        infowindow1.close();
				    };
				}

				// 위치 가져오기
				function getCurrentPos(){
				    navigator.geolocation.getCurrentPosition(locationLoadSuccess,locationLoadError);
				};


				//주소-좌표 변환 객체를 생성합니다
				var geocoder = new kakao.maps.services.Geocoder(); 
				 

				
				//for(var i in responsedata)
					//listData.push([responsedata[i]]);
			
					//console.log(listData);
					//var obj = eval(returnValue.responsedata);
					

				
				//var le = [['서울 관악구 양녕로 13-1','스트릿'],['서울 강남구 광평로 61','회화'],['서울 강북구 노해로 1','토익'],['서울시 강남구 강남대로123','스트릿'],['서울 송파구 도곡로 434','팝'],['서울 동대문구 경동시장로 1','유산소'],['서울 강남구 양재천로 163','프론트'],['서울 강남구 개포로 202','회화'],['서울 강남구 개포로 202','가요'],[]]
				 
				 $('#mapbtn').click(function(){

					 
					$.each(responsedata,function(addr, index) {
						console.log(addr);
						console.log(index);
						geocoder.addressSearch(addr, function(result, status){
							if (status === daum.maps.services.Status.OK) { 
								var coords = new daum.maps.LatLng(result[0].y, result[0].x); 
								
								var marker = new daum.maps.Marker({ 
									position: coords, clickable: true }); 
								
								
								
								// 마커를 지도에 표시합니다. 
								marker.setMap(map); 
								// 인포윈도우를 생성합니다 
								var infowindow = new kakao.maps.InfoWindow({ 
									content: '<div style="width:150px; text-align:center;padding:6px 0;">' + '<a href="http://www.naver.com">'+addr[1]+'</a>' + '</div>', 
									removable : true 
								}); 
								
								// 마커에 클릭이벤트를 등록합니다 
								kakao.maps.event.addListener(marker, 'click', function() { 
								// 마커 위에 인포윈도우를 표시합니다 
								infowindow.open(map, marker); 
								}); 
							}
							//markers.push(marker);
						});
						
					});
				 
				 })

			},
		  	error:function(xhr){
				   alert(xhr.status);
		  	}
		}
		
	  );

 
 
</script>
</body>
</html>
